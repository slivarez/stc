serverstat.cgi
*KOI8-R
Что он умеет?

  1. Показывает активные соединения пользователей: IP, время соединения, ссылка.
  2. Показывает клиентов SQUID'a которые за последнее время проявляли активность,
     а также количество активных соединений с сервером.
  3. Показывает информацию о сервере: время работы SQUID, загрузка процессора
     SQUID'ом в данный момент, средняя за 5 и 60 минут.
  4. Может добавить задание в очередь на разрыв определенного соединения, либо на
     разрыв всех соединений определенного клиента.
     
Настройка SQUID

  Для работы скрипта необходимо разрешить доступ к SQUID по протоколу cache_object с 
  определенного ip-адреса и убрать пароли на доступ к некоторым объектам кеша.
  В файле squid.conf необходимо прописать следующие строки:

      acl manager proto cache_object
      acl to_mgr src ip/mask
      http_access allow manager to_mgr
      http_access deny manager
      cachemgr_passwd none active_requests
      cachemgr_passwd none client_list
      cachemgr_passwd none info
  
  где ip - ip-адрес на котором работает STC. (т.е. site_ip в stc.conf/install.conf)
      
serverstat_type 1|2

    1 - Получение данных осуществляется через сокет
    2 - Получение данных осуществляется с использованием внешней программы squidclient
	
    Также второй вариант позволяет использовать аутентификацию по паролю для доступа к 
    данным cachemgr.
    Для настройки аутентификации в squid.conf изменяем строки:
	
	cachemgr_passwd pass active_requests
	cachemgr_passwd pass client_list
	cachemgr_passwd pass info
    
    где pass - пароль.
    
    Внимание! 
    Пароль должен быть одинаковым для 3 разделов.
    serverstat.cgi получает его путем анализа файла squid.conf.
    Аутентификация по паролю работает только тогда, когда установлен serverstat_type 2

*CP1251
serverstat.cgi

вРН НМ СЛЕЕР?

  1. оНЙЮГШБЮЕР ЮЙРХБМШЕ ЯНЕДХМЕМХЪ ОНКЭГНБЮРЕКЕИ: IP, БПЕЛЪ ЯНЕДХМЕМХЪ, ЯЯШКЙЮ.
  2. оНЙЮГШБЮЕР ЙКХЕМРНБ SQUID'a ЙНРНПШЕ ГЮ ОНЯКЕДМЕЕ БПЕЛЪ ОПНЪБКЪКХ ЮЙРХБМНЯРЭ,
     Ю РЮЙФЕ ЙНКХВЕЯРБН ЮЙРХБМШУ ЯНЕДХМЕМХИ Я ЯЕПБЕПНЛ.
  3. оНЙЮГШБЮЕР ХМТНПЛЮЖХЧ Н ЯЕПБЕПЕ: БПЕЛЪ ПЮАНРШ SQUID, ГЮЦПСГЙЮ ОПНЖЕЯЯНПЮ
     SQUID'НЛ Б ДЮММШИ ЛНЛЕМР, ЯПЕДМЪЪ ГЮ 5 Х 60 ЛХМСР.
  4. лНФЕР ДНАЮБХРЭ ГЮДЮМХЕ Б НВЕПЕДЭ МЮ ПЮГПШБ НОПЕДЕКЕММНЦН ЯНЕДХМЕМХЪ, КХАН МЮ
     ПЮГПШБ БЯЕУ ЯНЕДХМЕМХИ НОПЕДЕКЕММНЦН ЙКХЕМРЮ.

мЮЯРПНИЙЮ SQUID

  дКЪ ПЮАНРШ ЯЙПХОРЮ МЕНАУНДХЛН ПЮГПЕЬХРЭ ДНЯРСО Й SQUID ОН ОПНРНЙНКС cache_object Я
  НОПЕДЕКЕММНЦН ip-ЮДПЕЯЮ Х САПЮРЭ ОЮПНКХ МЮ ДНЯРСО Й МЕЙНРНПШЛ НАЗЕЙРЮЛ ЙЕЬЮ.
  б ТЮИКЕ squid.conf МЕНАУНДХЛН ОПНОХЯЮРЭ ЯКЕДСЧЫХЕ ЯРПНЙХ:

      acl manager proto cache_object
      acl to_mgr src ip/mask
      http_access allow manager to_mgr
      http_access deny manager
      cachemgr_passwd none active_requests
      cachemgr_passwd none client_list
      cachemgr_passwd none info

  ЦДЕ ip - ip-ЮДПЕЯ МЮ ЙНРНПНЛ ПЮАНРЮЕР STC. (Р.Е. site_ip Б stc.conf/install.conf)

serverstat_type 1|2

        1 - оНКСВЕМХЕ ДЮММШУ НЯСЫЕЯРБКЪЕРЯЪ ВЕПЕГ ЯНЙЕР
        2 - оНКСВЕМХЕ ДЮММШУ НЯСЫЕЯРБКЪЕРЯЪ Я ХЯОНКЭГНБЮМХЕЛ БМЕЬМЕИ ОПНЦПЮЛЛШ squidclient

        рЮЙФЕ БРНПНИ БЮПХЮМР ОНГБНКЪЕР ХЯОНКЭГНБЮРЭ ЮСРЕМРХТХЙЮЖХЧ ОН ОЮПНКЧ ДКЪ ДНЯРСОЮ Й ДЮММШЛ cachemgr.
        дКЪ МЮЯРПНИЙХ ЮСРЕМРХТХЙЮЖХХ Б squid.conf ХГЛЕМЪЕЛ ЯРПНЙХ:
	cachemgr_passwd pass active_requests
	cachemgr_passwd pass client_list
	cachemgr_passwd pass info
    ЦДЕ pass - ОЮПНКЭ.
    бМХЛЮМХЕ! 
	оЮПНКЭ ДНКФЕМ АШРЭ НДХМЮЙНБШЛ ДКЪ 3 ПЮГДЕКНБ.
        serverstat.cgi ОНКСВЮЕР ЕЦН ОСРЕЛ ЮМЮКХГЮ ТЮИКЮ squid.conf.
        юСРЕМРХТХЙЮЖХЪ ОН ОЮПНКЧ ПЮАНРЮЕР РНКЭЙН РНЦДЮ, ЙНЦДЮ СЯРЮМНБКЕМ serverstat_type 2
